% ============================================
% Topic 04: Microprocessors / å¾®å¤„ç†å™¨
% ============================================
\section{å¾®å¤„ç†å™¨ / Microprocessors}

% --------------------------------------------
% 1. Von Neumann vs Harvard Architecture
% --------------------------------------------
\begin{studybox}{å†¯è¯ºä¾æ›¼ vs å“ˆä½›æ¶æ„ (Von Neumann vs Harvard)}

\textbf{æ¦‚å¿µ (CN)}: è®¡ç®—æœºä½“ç³»ç»“æ„çš„ä¸¤ç§åŸºæœ¬æ¨¡å‹

\textbf{Term (EN)}: Von Neumann Architecture, Harvard Architecture

\tcblower

\textbf{å†¯è¯ºä¾æ›¼æ¶æ„}:
\begin{itemize}[leftmargin=*]
    \item ç¨‹åºå’Œæ•°æ®å…±äº«åŒä¸€å­˜å‚¨å™¨å’Œæ€»çº¿
    \item ç®€å•ï¼Œæˆæœ¬ä½
    \item ç“¶é¢ˆï¼šå†…å­˜å¸¦å®½æœ‰é™ï¼ˆå†¯è¯ºä¾æ›¼ç“¶é¢ˆï¼‰
    \item ä¾‹ï¼šx86 PC
\end{itemize}

\textbf{å“ˆä½›æ¶æ„}:
\begin{itemize}[leftmargin=*]
    \item ç¨‹åºå’Œæ•°æ®åˆ†å¼€å­˜å‚¨ï¼Œæœ‰ç‹¬ç«‹æ€»çº¿
    \item å¯åŒæ—¶å–æŒ‡ä»¤å’Œå–æ•°æ®
    \item ä¾‹ï¼šARM Cortex-M, ESP32
\end{itemize}

\textbf{Key Insight}: Harvard architecture allows simultaneous instruction fetch and data access = faster execution.

\end{studybox}

% --------------------------------------------
% 2. Interrupts
% --------------------------------------------
\begin{studybox}{ä¸­æ–­ç³»ç»Ÿ (Interrupts)}

\textbf{æ¦‚å¿µ (CN)}: å¤–éƒ¨æˆ–å†…éƒ¨äº‹ä»¶è§¦å‘ CPU æš‚åœå½“å‰ä»»åŠ¡ï¼Œè½¬å»æ‰§è¡Œä¸­æ–­æœåŠ¡ç¨‹åº (ISR)

\textbf{Term (EN)}: Interrupt, ISR (Interrupt Service Routine), IRQ, NVIC

\tcblower

\textbf{ä¸­æ–­ç±»å‹}:
\begin{itemize}[leftmargin=*]
    \item \textbf{å¤–éƒ¨ä¸­æ–­}: GPIO ç”µå¹³å˜åŒ–ã€å®šæ—¶å™¨æº¢å‡º
    \item \textbf{å†…éƒ¨ä¸­æ–­}: è½¯ä»¶ä¸­æ–­ã€å¼‚å¸¸ï¼ˆå¦‚é™¤é›¶ï¼‰
    \item \textbf{NMI}: ä¸å¯å±è”½ä¸­æ–­ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
\end{itemize}

\textbf{ä¸­æ–­å¤„ç†æµç¨‹}:
\begin{enumerate}
    \item ä¿å­˜ç°åœºï¼ˆå¯„å­˜å™¨å…¥æ ˆï¼‰
    \item è·³è½¬åˆ° ISR
    \item æ‰§è¡Œ ISR
    \item æ¢å¤ç°åœºï¼ˆå¯„å­˜å™¨å‡ºæ ˆï¼‰
    \item è¿”å›åŸç¨‹åº
\end{enumerate}

\textbf{Key Insight}: Interrupts allow real-time response to events without polling.

\end{studybox}

\begin{formulabox}
\textbf{ä¸­æ–­å»¶è¿Ÿ}:
\begin{equation}
    T_{latency} = T_{recognition} + T_{context\_save} + T_{ISR\_entry}
\end{equation}

\textbf{ESP32 ä¸­æ–­ä¼˜å…ˆçº§}: 1-7 çº§ï¼ˆ7 æœ€é«˜ï¼ŒNMIï¼‰

\textbf{å…³é”®å¯„å­˜å™¨}:
\begin{itemize}[leftmargin=*]
    \item \texttt{IE} (Interrupt Enable): ä¸­æ–­ä½¿èƒ½
    \item \texttt{IF} (Interrupt Flag): ä¸­æ–­æ ‡å¿—
    \item \texttt{NVIC\_IPR}: ä¼˜å…ˆçº§å¯„å­˜å™¨
\end{itemize}
\end{formulabox}

% --------------------------------------------
% 3. GPIO and Peripherals
% --------------------------------------------
\begin{studybox}{GPIO ä¸å¤–è®¾ (GPIO \& Peripherals)}

\textbf{æ¦‚å¿µ (CN)}: é€šç”¨è¾“å…¥è¾“å‡ºå¼•è„šåŠå…¶é…ç½®

\textbf{Term (EN)}: GPIO, Pull-up, Pull-down, Open-drain, Push-pull

\tcblower

\textbf{GPIO æ¨¡å¼}:
\begin{itemize}[leftmargin=*]
    \item \textbf{è¾“å…¥æ¨¡å¼}: æµ®ç©ºã€ä¸Šæ‹‰ã€ä¸‹æ‹‰
    \item \textbf{è¾“å‡ºæ¨¡å¼}: æ¨æŒ½è¾“å‡ºã€å¼€æ¼è¾“å‡º
\end{itemize}

\textbf{æ¨æŒ½ vs å¼€æ¼}:
\begin{center}
\begin{tabular}{lcc}
\toprule
\textbf{ç‰¹æ€§} & \textbf{æ¨æŒ½ (Push-Pull)} & \textbf{å¼€æ¼ (Open-Drain)} \\
\midrule
é«˜ç”µå¹³é©±åŠ¨ & æœ‰ & æ— ï¼ˆéœ€å¤–éƒ¨ä¸Šæ‹‰ï¼‰ \\
ä½ç”µå¹³é©±åŠ¨ & æœ‰ & æœ‰ \\
çº¿ä¸åŠŸèƒ½ & æ—  & æœ‰ \\
å…¸å‹åº”ç”¨ & LEDé©±åŠ¨ & I2Cæ€»çº¿ \\
\bottomrule
\end{tabular}
\end{center}

\textbf{Key Insight}: Open-drain allows multiple devices to share a bus (like I2C).

\end{studybox}

% --------------------------------------------
% 4. Communication Buses
% --------------------------------------------
\begin{studybox}{é€šä¿¡æ€»çº¿ (Communication Buses)}

\textbf{æ¦‚å¿µ (CN)}: å¾®å¤„ç†å™¨ä¸å¤–è®¾é€šä¿¡çš„æ ‡å‡†æ¥å£

\textbf{Term (EN)}: I2C, SPI, UART, CAN

\tcblower

\textbf{æ¯”è¾ƒè¡¨}:
\begin{center}
\begin{tabular}{lcccc}
\toprule
\textbf{åè®®} & \textbf{çº¿æ•°} & \textbf{é€Ÿåº¦} & \textbf{æ‹“æ‰‘} & \textbf{å…¸å‹åº”ç”¨} \\
\midrule
I2C & 2 (SDA, SCL) & 100k-3.4M & å¤šä¸»å¤šä» & ä¼ æ„Ÿå™¨ \\
SPI & 4 (MOSI, MISO, SCK, CS) & 10M+ & ä¸€ä¸»å¤šä» & Flash, LCD \\
UART & 2 (TX, RX) & 115200 & ç‚¹å¯¹ç‚¹ & è°ƒè¯•ä¸²å£ \\
CAN & 2 (CANH, CANL) & 1M & æ€»çº¿å‹ & æ±½è½¦ç”µå­ \\
\bottomrule
\end{tabular}
\end{center}

\textbf{Key Insight}: I2C uses fewer wires but is slower; SPI is faster but needs more pins.

\end{studybox}

\begin{formulabox}
\textbf{I2C åœ°å€æ ¼å¼}:
\begin{equation}
    \text{7-bit address} + \text{R/W bit} = \text{8-bit frame}
\end{equation}

\textbf{SPI æ—¶é’Ÿé…ç½®}:
\begin{itemize}[leftmargin=*]
    \item \textbf{CPOL}: æ—¶é’Ÿææ€§ï¼ˆç©ºé—²æ—¶é«˜/ä½ï¼‰
    \item \textbf{CPHA}: æ—¶é’Ÿç›¸ä½ï¼ˆç¬¬ä¸€/äºŒè¾¹æ²¿é‡‡æ ·ï¼‰
    \item å››ç§æ¨¡å¼: Mode 0 (CPOL=0, CPHA=0), Mode 1, Mode 2, Mode 3
\end{itemize}

\textbf{UART æ³¢ç‰¹ç‡}:
\begin{equation}
    \text{Baud Rate} = \frac{f_{clk}}{16 \times \text{Divisor}}
\end{equation}
\end{formulabox}

% --------------------------------------------
% 5. Memory Types
% --------------------------------------------
\begin{studybox}{å­˜å‚¨å™¨ç±»å‹ (Memory Types)}

\textbf{æ¦‚å¿µ (CN)}: ä¸åŒç±»å‹å­˜å‚¨å™¨çš„ç‰¹æ€§

\textbf{Term (EN)}: SRAM, DRAM, Flash, EEPROM, ROM

\tcblower

\begin{center}
\begin{tabular}{lccc}
\toprule
\textbf{ç±»å‹} & \textbf{æ˜“å¤±æ€§} & \textbf{å¯å†™} & \textbf{å…¸å‹ç”¨é€”} \\
\midrule
SRAM & æ˜“å¤± & è¯»å†™ & Cache, å¯„å­˜å™¨æ–‡ä»¶ \\
DRAM & æ˜“å¤± & è¯»å†™ & ä¸»å†…å­˜ \\
Flash & éæ˜“å¤± & è¯»/å—å†™ & ç¨‹åºå­˜å‚¨, SSD \\
EEPROM & éæ˜“å¤± & è¯»/å­—èŠ‚å†™ & é…ç½®å­˜å‚¨ \\
ROM & éæ˜“å¤± & åªè¯» & Bootloader \\
\bottomrule
\end{tabular}
\end{center}

\textbf{Key Insight}: ESP32 uses Flash for program storage and SRAM for runtime data.

\end{studybox}

% --------------------------------------------
% Thesis Connection
% --------------------------------------------
\begin{thesisbox}
\textbf{ESP32-S3 ä¸å¾®å¤„ç†å™¨}:

ä½ çš„è®ºæ–‡ä½¿ç”¨ \textbf{ESP32-S3}ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒæ ¸ Xtensa LX7 å¤„ç†å™¨ã€‚

\textbf{æ¶æ„}: ä¿®æ”¹ç‰ˆå“ˆä½›æ¶æ„ï¼ˆæŒ‡ä»¤å’Œæ•°æ®åˆ†å¼€ï¼Œä½†å…±äº«éƒ¨åˆ†æ€»çº¿ï¼‰

\textbf{é€šä¿¡æ€»çº¿ä½¿ç”¨}:
\begin{itemize}
    \item \textbf{I2C}: SHT40 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨, MPU-6050 åŠ é€Ÿåº¦è®¡
    \item \textbf{SPI}: æœªä½¿ç”¨ï¼ˆæ— å¤–éƒ¨ Flashï¼‰
    \item \textbf{UART}: è°ƒè¯•ä¸²å£
\end{itemize}

\textbf{ä¸­æ–­åº”ç”¨}:
\begin{itemize}
    \item GPIO ä¸­æ–­: PIR è¿åŠ¨ä¼ æ„Ÿå™¨è§¦å‘
    \item å®šæ—¶å™¨ä¸­æ–­: å®šæœŸé‡‡é›†ä¼ æ„Ÿå™¨æ•°æ®
\end{itemize}

\textbf{Jan Koller é—®é¢˜}: "How does ESP32 handle multiple sensors on I2C?"

\textbf{ç­”æ¡ˆ}: æ¯ä¸ª I2C è®¾å¤‡æœ‰å”¯ä¸€çš„ 7-bit åœ°å€ã€‚Master (ESP32) å…ˆå‘é€åœ°å€ï¼Œåªæœ‰åŒ¹é…çš„ Slave å“åº”ã€‚
\end{thesisbox}

% --------------------------------------------
% Exam Strategy
% --------------------------------------------
\begin{warnbox}[ğŸ”´ è€ƒè¯•é™·é˜± / Exam Pitfalls]
\begin{enumerate}
    \item \textbf{I2C åœ°å€å†²çª}: åŒä¸€åœ°å€çš„ä¸¤ä¸ªè®¾å¤‡ä¸èƒ½æŒ‚åœ¨åŒä¸€æ€»çº¿ä¸Šã€‚
    \item \textbf{ä¸­æ–­åµŒå¥—}: é«˜ä¼˜å…ˆçº§ä¸­æ–­å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§ ISRã€‚
    \item \textbf{GPIO æµ®ç©º}: æœªé…ç½®ä¸Šæ‹‰/ä¸‹æ‹‰çš„è¾“å…¥å¼•è„šè¯»å–å€¼ä¸ç¡®å®šã€‚
\end{enumerate}
\end{warnbox}
