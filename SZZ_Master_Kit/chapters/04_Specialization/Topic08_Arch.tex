% ============================================
% Topic 08: Computer Architecture / è®¡ç®—æœºä½“ç³»ç»“æ„
% ============================================
\section{è®¡ç®—æœºä½“ç³»ç»“æ„ / Computer Architecture}

% --------------------------------------------
% 1. Von Neumann Architecture
% --------------------------------------------
\begin{studybox}{å†¯è¯ºä¾æ›¼æ¶æ„ (Von Neumann Architecture)}

\textbf{æ¦‚å¿µ (CN)}: ç°ä»£è®¡ç®—æœºçš„åŸºç¡€æ¨¡å‹

\textbf{Term (EN)}: Stored-Program Computer, CPU, Memory, I/O

\tcblower

\textbf{äº”å¤§éƒ¨ä»¶}:
\begin{enumerate}
    \item \textbf{è¿ç®—å™¨ (ALU)}: æ‰§è¡Œç®—æœ¯å’Œé€»è¾‘è¿ç®—
    \item \textbf{æ§åˆ¶å™¨ (CU)}: æŒ‡ä»¤è§£ç å’Œæ‰§è¡Œæ§åˆ¶
    \item \textbf{å­˜å‚¨å™¨ (Memory)}: å­˜å‚¨ç¨‹åºå’Œæ•°æ®
    \item \textbf{è¾“å…¥è®¾å¤‡ (Input)}: é”®ç›˜ã€ä¼ æ„Ÿå™¨
    \item \textbf{è¾“å‡ºè®¾å¤‡ (Output)}: æ˜¾ç¤ºå™¨ã€æ‰§è¡Œå™¨
\end{enumerate}

\textbf{Key Insight}: Programs and data share the same memory = "stored program" concept.

\end{studybox}

\begin{formulabox}
\textbf{æŒ‡ä»¤å‘¨æœŸ}:
\begin{equation}
    \text{Instruction Cycle} = \text{Fetch} + \text{Decode} + \text{Execute} + \text{Memory} + \text{Write-back}
\end{equation}

\textbf{CPU æ€§èƒ½å…¬å¼}:
\begin{equation}
    \text{CPU Time} = \text{IC} \times \text{CPI} \times \text{Clock Period}
\end{equation}

å…¶ä¸­:
\begin{itemize}[leftmargin=*]
    \item IC = Instruction Countï¼ˆæŒ‡ä»¤æ•°ï¼‰
    \item CPI = Cycles Per Instructionï¼ˆæ¯æ¡æŒ‡ä»¤å‘¨æœŸæ•°ï¼‰
    \item Clock Period = $1 / f_{clk}$
\end{itemize}
\end{formulabox}

% --------------------------------------------
% 2. Pipeline
% --------------------------------------------
\begin{studybox}{æµæ°´çº¿ (Pipeline)}

\textbf{æ¦‚å¿µ (CN)}: å°†æŒ‡ä»¤æ‰§è¡Œåˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µï¼Œå¹¶è¡Œå¤„ç†å¤šæ¡æŒ‡ä»¤

\textbf{Term (EN)}: Pipeline, Pipeline Hazards, Stall, Forwarding

\tcblower

\textbf{ç»å…¸ 5 çº§æµæ°´çº¿}:
\begin{enumerate}
    \item \textbf{IF (Instruction Fetch)}: å–æŒ‡ä»¤
    \item \textbf{ID (Instruction Decode)}: è¯‘ç  + è¯»å¯„å­˜å™¨
    \item \textbf{EX (Execute)}: ALU æ‰§è¡Œ
    \item \textbf{MEM (Memory Access)}: è®¿å­˜
    \item \textbf{WB (Write Back)}: ç»“æœå†™å›å¯„å­˜å™¨
\end{enumerate}

\textbf{Key Insight}: Pipelining increases throughput, not latency. Each instruction still takes 5 cycles, but one completes every cycle.

\end{studybox}

\begin{formulabox}
\textbf{ç†æƒ³ååé‡}:
\begin{equation}
    \text{Throughput} = \frac{1}{\text{Clock Period}} \quad \text{(1 instruction/cycle)}
\end{equation}

\textbf{åŠ é€Ÿæ¯”}:
\begin{equation}
    \text{Speedup} = \frac{n \times k}{n + k - 1} \approx k \quad \text{(å½“ } n \gg k \text{)}
\end{equation}
å…¶ä¸­ $n$ = æŒ‡ä»¤æ•°, $k$ = æµæ°´çº¿çº§æ•°
\end{formulabox}

\begin{warnbox}[ğŸ”´ æµæ°´çº¿å†²çª / Pipeline Hazards]
\begin{enumerate}
    \item \textbf{ç»“æ„å†²çª (Structural)}: ç¡¬ä»¶èµ„æºå†²çªï¼ˆå¦‚åŒæ—¶è®¿é—®å†…å­˜ï¼‰
        \begin{itemize}
            \item è§£å†³: å¢åŠ ç¡¬ä»¶èµ„æºï¼ˆåˆ†ç¦» I-Cache å’Œ D-Cacheï¼‰
        \end{itemize}
    \item \textbf{æ•°æ®å†²çª (Data)}: RAW (Read After Write) ä¾èµ–
        \begin{itemize}
            \item è§£å†³: Forwardingï¼ˆæ•°æ®æ—è·¯ï¼‰ã€Stallï¼ˆæ’å…¥æ°”æ³¡ï¼‰
        \end{itemize}
    \item \textbf{æ§åˆ¶å†²çª (Control)}: åˆ†æ”¯æŒ‡ä»¤å¯¼è‡´çš„å†²çª
        \begin{itemize}
            \item è§£å†³: åˆ†æ”¯é¢„æµ‹ (Branch Prediction)ã€å»¶è¿Ÿæ§½
        \end{itemize}
\end{enumerate}
\end{warnbox}

% --------------------------------------------
% 3. Cache Memory
% --------------------------------------------
\begin{studybox}{é«˜é€Ÿç¼“å­˜ (Cache Memory)}

\textbf{æ¦‚å¿µ (CN)}: ä½äº CPU å’Œä¸»å­˜ä¹‹é—´çš„å°å®¹é‡é«˜é€Ÿå­˜å‚¨å™¨

\textbf{Term (EN)}: Cache, Hit Rate, Miss Rate, Locality

\tcblower

\textbf{å±€éƒ¨æ€§åŸç†}:
\begin{itemize}[leftmargin=*]
    \item \textbf{æ—¶é—´å±€éƒ¨æ€§}: åˆšè®¿é—®çš„æ•°æ®å¯èƒ½å¾ˆå¿«å†æ¬¡è®¿é—®
    \item \textbf{ç©ºé—´å±€éƒ¨æ€§}: è®¿é—®æŸåœ°å€åï¼Œé‚»è¿‘åœ°å€ä¹Ÿå¯èƒ½è¢«è®¿é—®
\end{itemize}

\textbf{Cache å±‚æ¬¡}:
\begin{itemize}[leftmargin=*]
    \item L1 Cache: æœ€å¿«ï¼Œæœ€å°ï¼ˆ32-64KBï¼‰ï¼ŒCPU å†…éƒ¨
    \item L2 Cache: ä¸­ç­‰ï¼ˆ256KB-1MBï¼‰
    \item L3 Cache: æœ€å¤§ï¼Œå¤šæ ¸å…±äº«ï¼ˆ2-32MBï¼‰
\end{itemize}

\textbf{Key Insight}: Cache exploits locality to bridge the CPU-Memory speed gap.

\end{studybox}

\begin{formulabox}
\textbf{å¹³å‡è®¿å­˜æ—¶é—´ (AMAT)}:
\begin{equation}
    \text{AMAT} = \text{Hit Time} + \text{Miss Rate} \times \text{Miss Penalty}
\end{equation}

\textbf{å‘½ä¸­ç‡}:
\begin{equation}
    \text{Hit Rate} = \frac{\text{Hits}}{\text{Hits} + \text{Misses}}
\end{equation}

\textbf{Cache æ˜ å°„æ–¹å¼}:
\begin{itemize}[leftmargin=*]
    \item \textbf{ç›´æ¥æ˜ å°„}: æ¯ä¸ªä¸»å­˜å—åªèƒ½æ˜ å°„åˆ°ä¸€ä¸ª Cache è¡Œ
    \item \textbf{å…¨ç›¸è”}: æ¯ä¸ªä¸»å­˜å—å¯ä»¥æ˜ å°„åˆ°ä»»æ„ Cache è¡Œ
    \item \textbf{ç»„ç›¸è”}: æŠ˜ä¸­æ–¹æ¡ˆï¼ˆn-way set associativeï¼‰
\end{itemize}
\end{formulabox}

% --------------------------------------------
% 4. Branch Prediction
% --------------------------------------------
\begin{studybox}{åˆ†æ”¯é¢„æµ‹ (Branch Prediction)}

\textbf{æ¦‚å¿µ (CN)}: åœ¨åˆ†æ”¯æŒ‡ä»¤ç»“æœç¡®å®šå‰é¢„æµ‹å…¶æ–¹å‘

\textbf{Term (EN)}: Static Prediction, Dynamic Prediction, BTB

\tcblower

\textbf{é¢„æµ‹ç­–ç•¥}:
\begin{itemize}[leftmargin=*]
    \item \textbf{é™æ€é¢„æµ‹}: æ€»æ˜¯é¢„æµ‹è·³è½¬/ä¸è·³è½¬
    \item \textbf{1-bit é¢„æµ‹å™¨}: ä¸Šæ¬¡è·³è½¬åˆ™é¢„æµ‹è·³è½¬
    \item \textbf{2-bit é¢„æµ‹å™¨}: å››çŠ¶æ€æœºï¼ˆå¼ºè·³è½¬ã€å¼±è·³è½¬ã€å¼±ä¸è·³è½¬ã€å¼ºä¸è·³è½¬ï¼‰
\end{itemize}

\textbf{Key Insight}: Modern CPUs achieve >95\% branch prediction accuracy.

\end{studybox}

\begin{formulabox}
\textbf{2-bit é¥±å’Œè®¡æ•°å™¨çŠ¶æ€è½¬æ¢}:
\begin{center}
\begin{tabular}{cc}
    çŠ¶æ€ 00 (å¼ºä¸è·³è½¬) $\xrightarrow{\text{taken}}$ çŠ¶æ€ 01 \\
    çŠ¶æ€ 01 (å¼±ä¸è·³è½¬) $\xrightarrow{\text{taken}}$ çŠ¶æ€ 10 \\
    çŠ¶æ€ 10 (å¼±è·³è½¬) $\xrightarrow{\text{not taken}}$ çŠ¶æ€ 01 \\
    çŠ¶æ€ 11 (å¼ºè·³è½¬) $\xrightarrow{\text{not taken}}$ çŠ¶æ€ 10 \\
\end{tabular}
\end{center}

\textbf{åˆ†æ”¯æƒ©ç½š}:
\begin{equation}
    \text{Penalty} = \text{Pipeline Depth} \times (1 - \text{Prediction Accuracy})
\end{equation}
\end{formulabox}

% --------------------------------------------
% 5. RISC vs CISC
% --------------------------------------------
\begin{studybox}{RISC vs CISC}

\textbf{æ¦‚å¿µ (CN)}: ä¸¤ç§æŒ‡ä»¤é›†è®¾è®¡å“²å­¦

\textbf{Term (EN)}: Reduced Instruction Set Computer, Complex Instruction Set Computer

\tcblower

\begin{center}
\begin{tabular}{lcc}
\toprule
\textbf{ç‰¹æ€§} & \textbf{RISC} & \textbf{CISC} \\
\midrule
æŒ‡ä»¤æ•°é‡ & å°‘ï¼ˆ100+ï¼‰ & å¤šï¼ˆ1000+ï¼‰ \\
æŒ‡ä»¤é•¿åº¦ & å›ºå®š & å¯å˜ \\
å¯»å€æ¨¡å¼ & ç®€å• & å¤æ‚ \\
å¯„å­˜å™¨æ•° & å¤šï¼ˆ32+ï¼‰ & å°‘ \\
æµæ°´çº¿ & æ˜“å®ç° & éš¾ \\
ä¾‹å­ & ARM, RISC-V, MIPS & x86, x64 \\
\bottomrule
\end{tabular}
\end{center}

\textbf{Key Insight}: RISC simplifies hardware, enabling faster clocks and better pipelining.

\end{studybox}

% --------------------------------------------
% Thesis Connection
% --------------------------------------------
\begin{thesisbox}
\textbf{ESP32-S3 ä½“ç³»ç»“æ„}:

ä½ çš„è®ºæ–‡ä½¿ç”¨ \textbf{ESP32-S3}ï¼ŒåŸºäº Xtensa LX7 æ¶æ„ï¼ˆç±» RISCï¼‰ã€‚

\textbf{æ¶æ„ç‰¹ç‚¹}:
\begin{itemize}
    \item \textbf{åŒæ ¸}: ä¸¤ä¸ª LX7 æ ¸å¿ƒï¼Œå¯å¹¶è¡Œå¤„ç†
    \item \textbf{Harvard}: åˆ†ç¦»çš„æŒ‡ä»¤å’Œæ•°æ®æ€»çº¿
    \item \textbf{Cache}: 16KB I-Cache, 16KB D-Cache
\end{itemize}

\textbf{Jan Koller é—®é¢˜}: "Is ESP32 RISC or CISC?"

\textbf{ç­”æ¡ˆ}: Xtensa æ˜¯ä¸€ç§å¯é…ç½®çš„ RISC æ¶æ„ã€‚å®ƒæœ‰å›ºå®šé•¿åº¦æŒ‡ä»¤ï¼ˆ24-bitï¼‰ã€å¤§é‡å¯„å­˜å™¨ï¼ˆ64ä¸ªï¼‰ã€ç®€å•å¯»å€æ¨¡å¼ã€‚
\end{thesisbox}

% --------------------------------------------
% Exam Strategy
% --------------------------------------------
\begin{warnbox}[ğŸ”´ è€ƒè¯•é™·é˜± / Exam Pitfalls]
\begin{enumerate}
    \item \textbf{æµæ°´çº¿åŠ é€Ÿæ¯”}: ä¸æ˜¯æ— é™çš„ï¼å—é™äºå†²çªå’Œä¾èµ–ã€‚
    \item \textbf{Cache æ˜ å°„}: ç›´æ¥æ˜ å°„å†²çªæœ€å¤šï¼Œå…¨ç›¸è”å†²çªæœ€å°‘ä½†ç¡¬ä»¶å¤æ‚ã€‚
    \item \textbf{åˆ†æ”¯é¢„æµ‹}: 2-bit æ¯” 1-bit æ›´ç¨³å®šï¼ˆéœ€è¦è¿ç»­ä¸¤æ¬¡é”™è¯¯æ‰æ”¹å˜é¢„æµ‹ï¼‰ã€‚
\end{enumerate}
\end{warnbox}
